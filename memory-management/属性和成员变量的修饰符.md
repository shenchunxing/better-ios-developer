# 属性和成员变量修饰符
### weak和unsafe_unretained
```
#import "ViewController.h"
#import "MJPerson.h"
@interface ViewController ()
@end
@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // ARC是LLVM编译器和Runtime系统相互协作的一个结果
    __strong MJPerson *person1;
    __weak MJPerson *person2;
    __unsafe_unretained MJPerson *person3;

    NSLog(@"111");

    {
        MJPerson *person = [[MJPerson alloc] init];
        person3 = person;//
        person2 = person;//__weak自动置为null
//        person1 = person;//离开作用域销毁，person不会被销毁，被强引用者
        int a;
        //&person,打印的是变量的地址
        //person 打印的变量指向的地址,也就是对象的地址
        NSLog(@"person对象 - %p ，person变量 - %p ，a变量 - %p",person , &person, &a);
        //__unsafe_unretained需要手动置为nil,否则坏内存访问崩溃
        person3 = nil;
    } // -[MJPerson dealloc]
    NSLog(@"222 - %@", person2); // null
    NSLog(@"222 - %@", person3); // null
}
@end
```
### 各种成员变量修饰符

```
- (void)weakLifeCycleTest {
    id obj0 = @"iTeaTime(技术清谈)";
    __weak id obj1 = obj0;
    id obj2 = [NSObject new];
    __weak id obj3 = [NSObject new]; 
    {
        id obj4 = [NSObject new];
    }
    __autoreleasing id obj5 = [NSObject new];
    __unsafe_unretained id obj6 = self;
    NSLog(@"obj0=%@, obj1=%@, obj2=%@, obj3=%@, obj5=%@, obj6=%@", obj0, obj1, obj2, obj3, obj5, obj6);
   
   //obj0=iTeaTime(技术清谈), 
   //obj1=iTeaTime(技术清谈), 
   //obj2=<NSObject: 0x6000030d01e0>, 
   //obj3=(null), 
   //obj5=<NSObject: 0x6000030d01d0>, 
   //obj6=<ViewController: 0x147f07910>
}
```

### automic修饰符
```
#import <Foundation/Foundation.h>
@interface MJPerson : NSObject
@property (assign, nonatomic) int age;
@property (copy, atomic) NSString *name;
@property (strong, atomic) NSMutableArray *data;
@end

/*
 nonatomic和atomic
 atom：原子，不可再分割的单位
 atomic：原子性
 给属性加上atomic修饰，可以保证属性的setter和getter都是原子性操作，也就是保证setter和gette内部是线程同步的
 
 //- (void)setName:(NSString *)name
//{
//    // 加锁
//    _name = name;
//    // 解锁
//}

//- (NSString *)name
//{
// 加锁
//    return _name;
// 解锁
//}
 */
```
```
#import <Foundation/Foundation.h>
#import "MJPerson.h"
int main(int argc, const char * argv[]) {
    @autoreleasepool {
        MJPerson *p = [[MJPerson alloc] init];
        for (int i = 0; i < 10; i++) {
 dispatch_async(dispatch_get_global_queue(0, 0), ^{
                // 加锁
                p.data = [NSMutableArray array]; //data如果用atomic修饰，p.data = [NSMutableArray array] 是线程安全的，如果用nonautomic修饰，需要加锁
                // 解锁
            });
        }

        NSMutableArray *array = p.data; //getter是线程安全的
        //automic只能保证getter和stter安全，下面3句不是线程安全的。需要加锁
        // 加锁
        [array addObject:@"1"];
        [array addObject:@"2"];
        [array addObject:@"3"];
        // 解锁
    }
    return 0;
}
```