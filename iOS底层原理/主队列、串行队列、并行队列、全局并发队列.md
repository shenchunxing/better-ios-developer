å‰è¨€
==

> ä¹‹å‰,æˆ‘ä»¬åœ¨æ¢ç´¢åŠ¨ç”»åŠæ¸²æŸ“ç›¸å…³åŸç†çš„æ—¶å€™,æˆ‘ä»¬è¾“å‡ºäº†å‡ ç¯‡æ–‡ç« ,è§£ç­”äº†`iOSåŠ¨ç”»æ˜¯å¦‚ä½•æ¸²æŸ“,ç‰¹æ•ˆæ˜¯å¦‚ä½•å·¥ä½œçš„ç–‘æƒ‘`ã€‚æˆ‘ä»¬æ·±æ„Ÿç³»ç»Ÿè®¾è®¡è€…åœ¨åˆ›ä½œè¿™äº›ç³»ç»Ÿæ¡†æ¶çš„æ—¶å€™,æ˜¯å¦‚æ­¤è„‘æ´å¤§å¼€,ä¹Ÿ **`æ·±æ·±æ„è¯†åˆ°äº†è§£ä¸€é—¨æŠ€æœ¯çš„åº•å±‚åŸç†å¯¹äºä»äº‹è¯¥æ–¹é¢å·¥ä½œçš„é‡è¦æ€§ã€‚`**
> 
> å› æ­¤æˆ‘ä»¬å†³å®š **`è¿›ä¸€æ­¥æ¢ç©¶iOSåº•å±‚åŸç†çš„ä»»åŠ¡`**ã€‚ç»§å‰é¢ä¸‰ç¯‡æ–‡ç« å¯¹`å¤šçº¿ç¨‹çŸ¥è¯†`è¿›è¡Œäº†ç®€å•çš„å›é¡¾ä¹‹å:
> 
> *   [1-è¿›ç¨‹ä¸çº¿ç¨‹ã€CPUä¸å¤šçº¿ç¨‹ã€ç”Ÿå‘½å‘¨æœŸã€çº¿ç¨‹æ± ã€çº¿ç¨‹é”ã€çº¿ç¨‹ä¸RunLoopã€iOSå¤šçº¿ç¨‹æ–¹æ¡ˆ](https://juejin.cn/post/7116774868128890911 "https://juejin.cn/post/7116774868128890911")
> *   [2-å¤šçº¿ç¨‹æ–¹æ¡ˆ pthreadã€NSThreadã€NSOperationã€NSOperationQueue](https://juejin.cn/post/7116789810781487117 "https://juejin.cn/post/7116789810781487117")
> *   [3-å¤šçº¿ç¨‹æ–¹æ¡ˆ GCD](https://juejin.cn/post/7116800779918245918 "https://juejin.cn/post/7116800779918245918") æœ¬ç¯‡æ–‡ç« å°†å¼€å¯å¯¹å¤šçº¿ç¨‹åº•å±‚åŸç†çš„æ¢ç´¢

ä¸€ã€å¯¹GCDçš„å¿«é€Ÿå›é¡¾
===========

å› ä¸º`NSOperation`ã€`NSOperationQueue`æ˜¯å¯¹`GCD`çš„OCå°è£…,å› æ­¤æˆ‘ä»¬åœ¨è¿™è¾¹æ¢ç´¢åº•å±‚åŸç†æ˜¯ç›´æ¥ä»GCDå…¥æ‰‹ã€‚

åœ¨ æ¢ç´¢ `GCD`çš„åº•å±‚å®ç°ä¹‹å‰,æˆ‘ä»¬å¿«é€Ÿè¿‡ä¸€é GCDç›¸å…³çš„çŸ¥è¯†ç‚¹,å¦‚æœä½ æƒ³æ›´å…¨é¢äº†è§£GCDä¹Ÿå¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡æ–‡ç« :[3-å¤šçº¿ç¨‹æ–¹æ¡ˆ GCD](https://juejin.cn/post/7116800779918245918 "https://juejin.cn/post/7116800779918245918")

1\. GCDçš„é˜Ÿåˆ—
----------

### 1.1 GCDçš„é˜Ÿåˆ—å¯ä»¥åˆ†ä¸º2å¤§ç±»å‹

*   å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent Dispatch Queueï¼‰ ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/316f67c03a344ebda9e78487d0570bfb~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)
    *   å¯ä»¥è®©å¤šä¸ªä»»åŠ¡å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œï¼ˆè‡ªåŠ¨å¼€å¯å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼‰
    *   å¹¶å‘åŠŸèƒ½åªæœ‰åœ¨å¼‚æ­¥`dispatch_async`å‡½æ•°ä¸‹æ‰æœ‰æ•ˆ
*   ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial Dispatch Queueï¼‰ ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5138e7c9f091427f82459f3e4b069d19~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)
    *   è®©ä»»åŠ¡ä¸€ä¸ªæ¥ç€ä¸€ä¸ªåœ°æ‰§è¡Œï¼ˆä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼‰

    // 1.åˆ›å»ºé˜Ÿåˆ—
    /*
      ç¬¬ä¸€ä¸ªå‚æ•°:Cè¯­è¨€çš„å­—ç¬¦ä¸²,æ ‡ç­¾
      ç¬¬äºŒä¸ªå‚æ•°:é˜Ÿåˆ—çš„ç±»å‹
      DISPATCH_QUEUE_CONCURRENT:å¹¶å‘
      DISPATCH_QUEUE_SERIAL:ä¸²è¡Œ
    */
    
    // å¹¶å‘é˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_queue_create("com.hp", DISPATCH_QUEUE_CONCURRENT);
    // ä¸²è¡Œé˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_queue_create("com.hp", DISPATCH_QUEUE_SERIAL);
    
    
    // 2.è·å¾—å…¨å±€å¹¶å‘é˜Ÿåˆ—
    // ç¬¬ä¸€ä¸ªå‚æ•°:å¯ä»¥è®¾ç½®ä¼˜å…ˆçº§
    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
    
    
    // 3.è·å¾—ä¸»é˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_get_main_queue();
    
    
    // 4.å¼‚æ­¥å‡½æ•°
    dispatch_async(queue, ^{
       NSLog(@"download1----%@",[NSThread currentThread]);
    });
        
        
    // 5.åŒæ­¥å‡½æ•°
     dispatch_sync(queue, ^{
       NSLog(@"download2----%@",[NSThread currentThread]);
    });  
    å¤åˆ¶ä»£ç 

### 1.2 åŒæ­¥ã€å¼‚æ­¥ã€å¹¶å‘ã€ä¸²è¡Œçš„æ³¨æ„ç‚¹ï¼š

*   åŒæ­¥å’Œå¼‚æ­¥ä¸»è¦å½±å“ï¼šèƒ½ä¸èƒ½å¼€å¯æ–°çš„çº¿ç¨‹
    *   åŒæ­¥ï¼šåœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œ`ä¸å…·å¤‡`å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›
    *   å¼‚æ­¥ï¼šåœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œ`å…·å¤‡`å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›
*   å¹¶å‘å’Œä¸²è¡Œä¸»è¦å½±å“ï¼šä»»åŠ¡çš„æ‰§è¡Œæ–¹å¼
    *   å¹¶å‘ï¼šå¤šä¸ªä»»åŠ¡å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œ
    *   ä¸²è¡Œï¼šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡

åˆ›å»ºä¸€ä¸ªåŒæ­¥ä¸²è¡Œé˜Ÿåˆ—

    // ä¸è®ºæ˜¯å“ªç§é˜Ÿåˆ—ï¼Œéƒ½ä¸ä¼šå¼€å¯æ–°çº¿ç¨‹
    dispatch_queue_t queue = dispatch_queue_create("com.hp", DISPATCH_QUEUE_SERIAL);
    // dispatch_queue_t queue = dispatch_queue_create("com.hp", DISPATCH_QUEUE_CONCURRENT);
    // dispatch_queue_t queue = dispatch_get_main_queue();
        
    dispatch_sync(queue, ^{
       NSLog(@"%@", [NSThread currentThread]);
    });
        
    dispatch_sync(queue, ^{
       NSLog(@"%@", [NSThread currentThread]);
    });
    
    // æ‰“å°è¾“å‡ºï¼š
    // <NSThread: 0x6000020198c0>{number = 1, name = main}
    // <NSThread: 0x6000020191c0>{number = 1, name = main}
    å¤åˆ¶ä»£ç 

åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å¹¶å‘é˜Ÿåˆ—

    // å¹¶å‘é˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_queue_create("com.hp", DISPATCH_QUEUE_CONCURRENT);
    
    dispatch_async(queue, ^{
       NSLog(@"%@", [NSThread currentThread]);
    });
        
    dispatch_async(queue, ^{
       NSLog(@"%@", [NSThread currentThread]);
    });
    
    // æ‰“å°è¾“å‡ºï¼š
    // <NSThread: 0x6000020198c0>{number = 4, name = (null)}
    // <NSThread: 0x6000020191c0>{number = 5, name = (null)}
    å¤åˆ¶ä»£ç 

åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—

    // ä¸²è¡Œé˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_queue_create("com.hp", DISPATCH_QUEUE_SERIAL);
        
    dispatch_async(queue, ^{
       NSLog(@"%@", [NSThread currentThread]);
    });
        
    dispatch_async(queue, ^{
       NSLog(@"%@", [NSThread currentThread]);
    });
    
    // æ‰“å°è¾“å‡ºï¼š
    // <NSThread: 0x6000020198c0>{number = 5, name = (null)}
    // <NSThread: 0x6000020191c0>{number = 5, name = (null)}
    å¤åˆ¶ä»£ç 

åœ¨ä¸»é˜Ÿåˆ—ä¸­ï¼Œä¸è®ºæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥éƒ½ä¸ä¼šå¼€å¯å­çº¿ç¨‹

    dispatch_queue_t queue = dispatch_get_main_queue();
    
    dispatch_async(queue, ^{
       NSLog(@"%@", [NSThread currentThread]);
    });
    
    // æ‰“å°è¾“å‡ºï¼š
    // <NSThread: 0x6000020198c0>{number = 1, name = main}
    å¤åˆ¶ä»£ç 

ä½†æ˜¯ä½¿ç”¨`syncå‡½æ•°`å¾€å½“å‰ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ï¼Œä¼šå¡ä½å½“å‰çš„ä¸²è¡Œé˜Ÿåˆ—ï¼ˆäº§ç”Ÿæ­»é”ï¼‰

ç»¼ä¸Šæ‰€è¿°å¯ä»¥ç”¨ä¸€å¼ å›¾æ¥æ¦‚è¿°

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/32e883a29f0b4a9aa6bb0c614bb1edff~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

### 1.3 `dispatch_get_global_queue`å’Œ`dispatch_queue_create`çš„åŒºåˆ«

æˆ‘ä»¬åœ¨ä»£ç é‡Œåˆ†åˆ«åˆ›å»ºä¸¤ç§é˜Ÿåˆ—ï¼Œç„¶åæ‰“å°å‘ç°ï¼Œå…¨å±€é˜Ÿåˆ—çš„åœ°å€éƒ½æ˜¯åŒä¸€ä¸ªï¼Œè€Œ`dispatch_queue_create`çš„å¯¹è±¡éƒ½ä¸ç›¸åŒ

    dispatch_queue_t queue1 = dispatch_get_global_queue(0, 0);
    dispatch_queue_t queue2 = dispatch_get_global_queue(0, 0);
    dispatch_queue_t queue3 = dispatch_queue_create("queu3", DISPATCH_QUEUE_CONCURRENT);
    dispatch_queue_t queue4 = dispatch_queue_create("queu4", DISPATCH_QUEUE_CONCURRENT);
    dispatch_queue_t queue5 = dispatch_queue_create("queu5", DISPATCH_QUEUE_CONCURRENT);
    
    NSLog(@"%p %p %p %p %p", queue1, queue2, queue3, queue4, queue5);
    
    // åˆ†åˆ«è¾“å‡ºï¼š0x10c5d8080 0x10c5d8080 0x6000037c3180 0x6000037c1580 0x6000037c3200
    å¤åˆ¶ä»£ç 

2\. GCDçš„é˜Ÿåˆ—ç»„
-----------

ç¬¬ä¸€ç§åˆ›å»ºæ–¹å¼

    // 1.åˆ›å»ºé˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_get_global_queue(0, 0);
        
    // 2.åˆ›å»ºé˜Ÿåˆ—ç»„
    dispatch_group_t group = dispatch_group_create();
       
    // 3.æŠŠä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ 
    dispatch_group_async(group, queue, ^{
      	NSLog(@"1----%@",[NSThread currentThread]);
    });
        
        
    dispatch_group_async(group, queue, ^{
       	NSLog(@"2----%@",[NSThread currentThread]);
    });
    
    // 4.æ‹¦æˆªé€šçŸ¥,å½“é˜Ÿåˆ—ç»„ä¸­æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•çš„æ—¶å€™å›è¿›å…¥åˆ°ä¸‹é¢çš„æ–¹æ³•
    dispatch_group_notify(group, queue, ^{     
        NSLog(@"-------dispatch_group_notify-------");
    });
    å¤åˆ¶ä»£ç 

ç¬¬äºŒç§åˆ›å»ºæ–¹å¼

    // 1.åˆ›å»ºé˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_get_global_queue(0, 0);
        
    // 2.åˆ›å»ºé˜Ÿåˆ—ç»„
    dispatch_group_t group = dispatch_group_create();
        
    // 3.åœ¨è¯¥æ–¹æ³•åé¢çš„å¼‚æ­¥ä»»åŠ¡ä¼šè¢«çº³å…¥åˆ°é˜Ÿåˆ—ç»„çš„ç›‘å¬èŒƒå›´,è¿›å…¥ç¾¤ç»„
    // dispatch_group_enter|dispatch_group_leave å¿…é¡»è¦é…å¯¹ä½¿ç”¨
    
    dispatch_group_enter(group);
        
    dispatch_async(queue, ^{
       NSLog(@"1----%@",[NSThread currentThread]);
            
       //ç¦»å¼€ç¾¤ç»„       	 
       dispatch_group_leave(group);
    });
    
        
    dispatch_group_enter(group);
        
    dispatch_async(queue, ^{
       NSLog(@"2----%@",[NSThread currentThread]);
            
       //ç¦»å¼€ç¾¤ç»„       	 
       dispatch_group_leave(group);
    });
        
        
    // æ‹¦æˆªé€šçŸ¥
    // å†…éƒ¨æœ¬èº«æ˜¯å¼‚æ­¥çš„
    dispatch_group_notify(group, queue, ^{
    	NSLog(@"-------dispatch_group_notify-------");
    });
    å¤åˆ¶ä»£ç 

ç¬¬ä¸‰ç§æ–¹å¼

    // 1.åˆ›å»ºé˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_get_global_queue(0, 0);
        
    // 2.åˆ›å»ºé˜Ÿåˆ—ç»„
    dispatch_group_t group = dispatch_group_create();
       
    // 3.æŠŠä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ 
    dispatch_group_async(group, queue, ^{
      	NSLog(@"1----%@",[NSThread currentThread]);
    });
        
        
    dispatch_group_async(group, queue, ^{
       	NSLog(@"2----%@",[NSThread currentThread]);
    });
    
    // 4.ä¼šé˜»å¡çº¿ç¨‹
    // ç›´åˆ°é˜Ÿåˆ—ç»„ä¸­æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰èƒ½æ‰§è¡Œ
    dispatch_group_wait(group, DISPATCH_TIME_FOREVER);
    
    NSLog(@"----end----");
    å¤åˆ¶ä»£ç 

3\. é˜Ÿåˆ—å‡½æ•°çš„åº”ç”¨
-----------

è®¨è®ºä¸€ä¸‹ä»¥ä¸‹çš„å‡½æ•°æ‰§è¡Œé¡ºåºæ˜¯æ€æ ·çš„,æ£€éªŒå¯¹GCDçš„æŒæ¡ç¨‹åº¦

    - (void)textDemo2{
        // åŒæ­¥é˜Ÿåˆ—
        dispatch_queue_t queue = dispatch_queue_create("cooci", DISPATCH_QUEUE_CONCURRENT);
        NSLog(@"1");
        // å¼‚æ­¥å‡½æ•°
        dispatch_async(queue, ^{
            NSLog(@"2");
            // åŒæ­¥
            dispatch_sync(queue, ^{
                NSLog(@"3");
            });
            NSLog(@"4");
        });
        NSLog(@"5");
    }
    å¤åˆ¶ä»£ç 

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/249969d64b184ae78d41ba86407ef9a6~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

æˆ‘ä»¬çŸ¥é“æ— è®ºåŒæ­¥è¿˜æ˜¯å¼‚æ­¥å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªè€—æ—¶ä»»åŠ¡ã€‚

![ä¸²è¡Œå’Œå¹¶å‘.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a186bfaf12c4f428ce7f5d8237e684e~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

å†æ¥ä¸€ä¸ªï¼Œæ®è¯´è¿™ä¸ªæ˜¯æ–°æµªçš„é¢è¯•é¢˜

    - (void)wbinterDemo{
        dispatch_queue_t queue = dispatch_queue_create("com.lg.cooci.cn", DISPATCH_QUEUE_CONCURRENT);
    
        dispatch_async(queue, ^{
            NSLog(@"1");
        });
        
        dispatch_async(queue, ^{
            NSLog(@"2");
        });
    
        dispatch_sync(queue, ^{ NSLog(@"3"); });
        
        NSLog(@"0");
    
        dispatch_async(queue, ^{
            NSLog(@"7");
        });
        dispatch_async(queue, ^{
            NSLog(@"8");
        });
        dispatch_async(queue, ^{
            NSLog(@"9");
        });
        // A: 1230789
        // B: 1237890
        // C: 3120798
        // D: 2137890
    }
    å¤åˆ¶ä»£ç 

æ­£ç¡®ç­”æ¡ˆæ˜¯A åˆ†æï¼šé¦–å…ˆå¼€å¯çš„æ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œ12è¡Œçš„ä»£ç é˜»å¡çš„æ˜¯13è¡Œä»¥ä¸‹çš„ï¼Œæ‰€ä»¥3åœ¨0ä¹‹å‰ï¼Œ123æ²¡æœ‰é¡ºåºï¼Œ789ä¹Ÿæ²¡æœ‰é¡ºåºï¼Œä½¿ç”¨æ’é™¤æ³•å¾—åˆ°A

4\. æ­»é”é—®é¢˜
--------

å¦‚æœæŠŠé˜Ÿåˆ—ä¿®æ”¹ä¸ºä¸²è¡Œé˜Ÿåˆ—é‚£ä¹ˆæ­¤æ—¶è°ƒç”¨çš„é¡ºåºä¸ºï¼š

    - (void)textDemo1{
        dispatch_queue_t queue = dispatch_queue_create("cooci", NULL);
        NSLog(@"1");
        dispatch_async(queue, ^{
            NSLog(@"2");
            dispatch_sync(queue, ^{
                NSLog(@"3");
            });
            NSLog(@"4");
        });
        NSLog(@"5");
    }
    å¤åˆ¶ä»£ç 

æ­¤æ—¶æ‰“å°å´©æºƒï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1029281d249248c8988822f271913185~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

![æ­»é”é—®é¢˜.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/00e92884ad5b43119fb2594c4b541f7c~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

æ­¤æ—¶åœ¨è¿™é‡Œ:

*   2æ‰§è¡Œå®Œä¹‹åï¼Œæ‰§è¡Œåˆ°äº†ä¸€ä¸ªä»£ç å—(`dispatch_sync`è€Œ`sync`çš„ç‰¹ç‚¹æ˜¯é˜»å¡ï¼Œå¿…é¡»ç­‰åˆ°è‡ªå·±æ‰§è¡Œå®Œä¹‹åæ‰å¯ä»¥)
*   è€Œé˜Ÿåˆ—ç”±äºæ˜¯å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™ï¼Œæ‰€ä»¥æ­¤æ—¶é€ æˆäº†4ç­‰å¾…å—æ‰§è¡Œå®Œæˆ
*   å—çš„æ‰§è¡Œå®Œæˆéœ€è¦3æ‰§è¡Œï¼Œè€Œ3åˆç­‰å¾…4æ‰§è¡Œï¼Œè¿™æ ·å°±é€ æˆäº†ä¸€ä¸ªæ­»é”çš„é—®é¢˜ã€‚

æ”¹è¿›ï¼šé‚£ä¹ˆæˆ‘ä»¬æŠŠ4çš„ä»»åŠ¡åˆ é™¤ï¼Œè¿˜ä¼šé€ æˆæ­»é”å˜›ï¼Ÿ

*   ç­”æ¡ˆæ˜¯ï¼šè¿˜ä¼šæ­»é” è§‚å¯Ÿè°ƒç”¨æ ˆå‘ç°æ­»é”çš„å‡½æ•°æ˜¯ï¼š`_dispatch_sync_f_slow`
*   å®é™…ä¸Šå‘ç”Ÿæ­»é”çš„`dispatch_async`å’Œ`dispatch_sync`è¿™ä¸¤ä¸ªä»£ç å—

5\. GCDåˆ›å»ºé˜Ÿåˆ—å››ç§æ–¹å¼
---------------

        // OS_dispatch_queue_serial ä¸²è¡Œ
        dispatch_queue_t serial = dispatch_queue_create("hb", DISPATCH_QUEUE_SERIAL);
        // OS_dispatch_queue_concurrent å¹¶å‘
        dispatch_queue_t conque = dispatch_queue_create("test", DISPATCH_QUEUE_CONCURRENT);
        // DISPATCH_QUEUE_SERIAL max && 1
        // queue å¯¹è±¡ alloc init class
        dispatch_queue_t mainQueue = dispatch_get_main_queue();
    
        dispatch_queue_t globQueue = dispatch_get_global_queue(0, 0);
    å¤åˆ¶ä»£ç 

æˆ‘ä»¬çŸ¥é“`dispatch_get_main_queue`æ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—å¹¶ä¸”è¿™ä¸ªé˜Ÿåˆ—æ˜¯`åœ¨main()`è°ƒç”¨ä¹‹å‰ä¸»çº¿ç¨‹è‡ªåŠ¨åˆ›å»ºçš„ï¼Œ`dispatch_get_global_queue`æ˜¯ä¸€ä¸ªå¹¶å‘é˜Ÿåˆ—ã€‚ æ‰“å°è¾“å‡ºå¯ä»¥å¾—åˆ°è¿™äº›ä¿¡æ¯ï¼š ![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c147c66c53bd4a57b3d9de579d72bfb9~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

6\. å…¶ä»–å¸¸ç”¨æ–¹æ³•
----------

    // 1.å»¶è¿Ÿæ‰§è¡Œçš„å‡ ç§æ–¹æ³•
    // 1.1
    [self performSelector:@selector(task) withObject:nil afterDelay:2.0];
    
    // 1.2
    // repeatsï¼šæ˜¯å¦é‡å¤è°ƒç”¨
    [NSTimer scheduledTimerWithTimeInterval:2.0 target:self selector:@selector(task) userInfo:nil repeats:YES];
    
    // 1.3
    // å¯ä»¥è®¾ç½®é˜Ÿåˆ—æ§åˆ¶åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œå»¶è¿Ÿ
    dispatch_queue_t queue = dispatch_get_global_queue(0, 0);
    
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), queue, ^{
       NSLog(@"GCD----%@",[NSThread currentThread]);
    });
    
    
    // 2.ä¸€æ¬¡æ€§ä»£ç 
    // æ•´ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åªä¼šæ‰§è¡Œä¸€æ¬¡
    // onceTokenç”¨æ¥è®°å½•è¯¥éƒ¨åˆ†çš„ä»£ç æ˜¯å¦è¢«æ‰§è¡Œè¿‡
    
    static dispatch_once_t onceToken;
    
    dispatch_once(&onceToken, ^{
      NSLog(@"---once----");
    });
    
    
    // 3.å¿«é€Ÿéå†
    // å¼€å¤šä¸ªçº¿ç¨‹è¿›è¡Œéå†
    /*
       ç¬¬ä¸€ä¸ªå‚æ•°:éå†çš„æ¬¡æ•°
       ç¬¬äºŒä¸ªå‚æ•°:é˜Ÿåˆ—(å¹¶å‘é˜Ÿåˆ—)
       ç¬¬ä¸‰ä¸ªå‚æ•°:index ç´¢å¼•
    */
    dispatch_apply(10, dispatch_get_global_queue(0, 0), ^(size_t index) {
       NSLog(@"%zd---%@",index,[NSThread currentThread]);
    });
    
    // 4.æ …æ å‡½æ•°
    // æ …æ å‡½æ•°ä¸èƒ½ä½¿ç”¨å…¨å±€å¹¶å‘é˜Ÿåˆ—
    // æ …æ å‡½æ•°ä¹‹åçš„çº¿ç¨‹éƒ½ä¼šå»¶åæ‰§è¡Œ
    dispatch_queue_t queue = dispatch_queue_create("download", DISPATCH_QUEUE_CONCURRENT);
    
    dispatch_async(queue, ^{
       NSLog(@"%@", [NSThread currentThread]);
    });    
        
    dispatch_barrier_async(queue, ^{
       NSLog(@"+++++++++++++++++++++++++++++");
    });
        
    dispatch_async(queue, ^{
       NSLog(@"%@", [NSThread currentThread]);
    }); 
    å¤åˆ¶ä»£ç 

äºŒã€æ¢ç´¢GCDçš„åº•å±‚å®ç°
============

è‹¹æœå®˜æ–¹æ˜¯å¯¹GCDåšäº†å¼€æºçš„,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»ä¸‹è½½ä¸€ä¸‹GCDæºç ,é˜…è¯»å­¦ä¹ ä¸€ä¸‹ã€‚

1\. æºç ä¸‹è½½
--------

æˆ‘ä»¬å¯ä»¥é€šè¿‡GCDçš„æºç `libdispatch.dylib`æ¥åˆ†æå†…éƒ¨å®ç°

`libdispatch.dylib`çš„ä¸‹è½½åœ°å€ï¼š[opensource.apple.com/release/macâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fopensource.apple.com%2Frelease%2Fmacos-1015.html "https://link.juejin.cn?target=https%3A%2F%2Fopensource.apple.com%2Frelease%2Fmacos-1015.html")

ç„¶åæ‰¾åˆ°`libdispatch-1173.0.3`è¿›è¡Œä¸‹è½½

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7fcc3caf02a141bca41114422a4f5729~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

2.æºç åˆ†æ
------

### 2.1 ä¸»é˜Ÿåˆ—åˆ†æ

æŸ¥çœ‹ä¸»é˜Ÿåˆ—çš„ `api`å¦‚ä¸‹å›¾ï¼š ![dispatch_get_main_queue](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a32f28e9319943de970a01189ba89f3f~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

*   ä¸»é˜Ÿåˆ—æ˜¯ä¸€ä¸ª`ç‰¹æ®Šçš„ä¸²è¡Œé˜Ÿåˆ—`
*   ä¸»é˜Ÿåˆ—åœ¨è°ƒç”¨`main()`å‡½æ•°ä¹‹å‰è‡ªåŠ¨åˆ›å»ºçš„ã€‚
*   ä¸»é˜Ÿåˆ—åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ç”¨äºä¸ä¸»çº¿ç¨‹å’Œ`main runloop` äº¤äº’ã€‚

> é‚£ä¹ˆæ–­ç‚¹åœ¨`main` å‡½æ•°å¤„å»éªŒè¯ä¸€ä¸‹

![éªŒè¯main_queue](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5268c7c73b1843af93b5521ec645ba8f~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

> é€šè¿‡æ–­ç‚¹ï¼Œç¡®å®éªŒè¯äº†ä¸»é˜Ÿåˆ—æ˜¯åœ¨è°ƒç”¨`main()`å‡½æ•°ä¹‹å‰è‡ªåŠ¨åˆ›å»ºçš„ã€‚

é‚£ä¹ˆæˆ‘ä»¬è¦çœ‹åº•å±‚æºç ï¼Œè¯¥æ€ä¹ˆçœ‹å•Šï¼Œé¦–å…ˆæˆ‘ä»¬å¾—çŸ¥é“ `GCD`æ˜¯å±äºå“ªä¸ªæºç çš„ï¼Œæ‰èƒ½è¿›ä¸€æ­¥å»æ¢ç´¢åˆ†æã€‚

*   å†æ¬¡é€šè¿‡æ–­ç‚¹å¯»æ‰¾ï¼Œå¦‚ä¸‹å›¾

![å¯»æ‰¾ GCDæºç å‡ºå¤„](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a9fbd0ce86c1415ba8f9fe508d320cc8~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp) é€šè¿‡ `bt` æ‰“å°å †æ ˆä¿¡æ¯ï¼Œå¯ä»¥å®šä½åˆ°`libdispatch.dylib`åŠ¨æ€åº“ï¼Œé‚£ä¹ˆå°±å»è‹¹æœå¼€æºç½‘ç«™å»ä¸‹è½½æºç è¯•è¯•ã€‚

*   ä¸‹è½½[libdispatch.dylib](https://link.juejin.cn?target=https%3A%2F%2Fopensource.apple.com%2Frelease%2Fmacos-114.html "https://opensource.apple.com/release/macos-114.html")æºç ï¼Œæ¢ç´¢`GCD`ã€‚

![libdispatch](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a64633dfa22a488f858870ad7320ecb5~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

*   `libdispatch` æºç 

![GCDæºç libdispatch](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f1070dbebd644d4aab740c730ae48e60~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

> **`libdispatch`æºç é˜…è¯»èµ·æ¥æ¯”è¾ƒæœ‰æŒ‘æˆ˜æ€§**

*   æ³¨é‡Šéå¸¸çš„å°‘
*   å®å®šä¹‰éå¸¸çš„å¤š
*   å‡½æ•°åéå¸¸çš„é•¿

**æºç æœç´¢`dispatch_get_main_queue`:**

![dispatch_get_main_queue](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e0b22642731a49a3a503722defd325d3~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

> `dispatch_get_main_queue` æ˜¯é€šè¿‡`DISPATCH_GLOBAL_OBJECT`è¿”å›çš„ï¼Œæ˜¯ä¸€ä¸ªå®å®šä¹‰

*   `DISPATCH_GLOBAL_OBJECT`

![DISPATCH_GLOBAL_OBJECTå®å®šä¹‰](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba6944fb98774b7fb19d22e8fe948365~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

*   é€šè¿‡`_dispatch_main_q`å‚æ•°æœç´¢

    dispatch_get_main_queue(void)
    {
    	return DISPATCH_GLOBAL_OBJECT(dispatch_queue_main_t, _dispatch_main_q);
    }
    å¤åˆ¶ä»£ç 

![_dispatch_main_q](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/84c369408e9f4fc4a173f7ab42a5c2dc~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

*   è¿˜å¯ä»¥é€šè¿‡ä¸»é˜Ÿåˆ—çš„`dq_label`æœç´¢å¦‚ä¸‹ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/667c785934bf4e5fb33471b6ac57d80a~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp) åœ¨æºç ä¸­æœ‰`dq_serialnum = 1`ï¼Œè¿™æ˜¯ä¸æ˜¯æ„å‘³ç€å¯ä»¥ä½œä¸º`ä¸»é˜Ÿåˆ—`å°±æ˜¯ `ä¸²è¡Œé˜Ÿåˆ—`çš„ä¾æ®å‘¢ï¼Ÿ ç°åœ¨è¿˜ä¸å¾—è€ŒçŸ¥ï¼Œé‚£ä¹ˆå»çœ‹çœ‹ä¸²è¡Œé˜Ÿåˆ—åº•å±‚æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œæˆ–è®¸å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆï¼

*   ä¸»é˜Ÿåˆ—çš„åˆå§‹åŒ–æ˜¯åœ¨`dispatch_init()`æ–¹æ³•ä¸­ï¼Ÿ

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e66d19a6732f41e4af9a17a3c026f85b~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

*   åœ¨`dispatch_init()`ä¸­æˆåŠŸæ‰¾åˆ°äº†ä¸»é˜Ÿåˆ—åˆå§‹åŒ–çš„åœ°æ–¹ï¼Œ
*   è·å–é»˜è®¤é˜Ÿåˆ—ï¼Œ
*   å¹¶å°†ä¸»é˜Ÿåˆ—åœ°å€ç»‘å®šåˆ°å½“å‰é˜Ÿåˆ—å’Œä¸»çº¿ç¨‹ä¸­

### 2.2 ä¸²è¡Œã€å¹¶å‘é˜Ÿåˆ—åˆ†æ

> `ä¸²è¡Œé˜Ÿåˆ—`å’Œ`å¹¶å‘é˜Ÿåˆ—`éƒ½é€šè¿‡`dispatch_queue_create`åˆ›å»ºçš„ï¼Œé‚£ä¹ˆå»æœç´¢ä¸€ä¸‹

![dispatch_queue_create](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d10974c614d24020a098e9f509ed1cfb~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp) é€šè¿‡æœç´¢å®šä½åˆ°`dispatch_queue_create`ï¼Œåœ¨é€šè¿‡è¿”å›çš„æ˜¯`_dispatch_lane_create_with_target`ï¼Œå†ç»§ç»­æœç´¢

![_dispatch_lane_create_with_target](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/894f6be312054492b4c6f9b007f44533~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

*   ä»£ç æ¯”è¾ƒé•¿ï¼Œä»è¿”å›å€¼çœ‹ï¼Œå†æ¨å¯¼

![ä»è¿”å›å€¼æ¨å¯¼](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/594a7e9fdfff4d3e93145d49e3aa8c62~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

*   `_dispatch_object_alloc`ç”³è¯·å†…å­˜ç©ºé—´
*   `_dispatch_queue_init`æ„é€ å‡½æ•°åˆå§‹åŒ–
*   åˆ¤æ–­æ˜¯å¦ä¸ºå¹¶å‘é˜Ÿåˆ—ï¼Œå¦‚æœæ˜¯ï¼Œä¼ å…¥`DISPATCH_QUEUE_WIDTH_MAX`ï¼Œå¦åˆ™ä¼ å…¥`1`ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸²è¡Œé˜Ÿåˆ—è¿™é‡Œä¼ å…¥`1`ï¼Œå¦‚æœæ˜¯å¹¶å‘é˜Ÿåˆ—ï¼Œåˆ™ä¼ å…¥`DISPATCH_QUEUE_WIDTH_MAX`

![DISPATCH_QUEUE_WIDTH_MAX](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5b620cb7b2a4397aeac58632d07fdb3~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

*   å¯¹`dq`è¿›è¡Œè®¾ç½®ï¼Œå¦‚`dq_label`ã€`dq_priority`ç­‰

**`_dispatch_queue_init`** ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/52bb87cbbc7a4de1bc1f423ec387c683~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

*   æŠŠå‰é¢çš„ `width` ä¼ è¿›æ¥ï¼Œèµ‹å€¼ `dqf |= DQF_WIDTH(width)`
*   `DQF_WIDTH(width)`,ä¹Ÿå°±æ˜¯ç”¨æ¥ç¡®å®šé˜Ÿåˆ—çš„ç±»å‹ï¼Œä»¥æ­¤æ¥åŒºåˆ†`ä¸²è¡Œé˜Ÿåˆ—`å’Œ`å¹¶å‘é˜Ÿåˆ—`

![DISPATCH_QUEUE_SERIAL_NUMBER_INIT](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2458d61cd3334eb69e93b7950aca5dc8~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp) å…¶ä»–å‚æ•°`vtable`ã€`dqai`ï¼Œåˆ†åˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç»§ç»­æ¢ç´¢ ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/77773e02c3eb458287e61e668f142754~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

*   **`dqai`åˆå§‹åŒ–**

**åœ¨å¼€å¤´æœ‰è¿™ä¹ˆä¸€å¥ä»£ç **

    // dqai åˆ›å»º - dqaä¼ å…¥çš„å±æ€§ä¸²è¡Œè¿˜æ˜¯å¹¶è¡Œ
    dispatch_queue_attr_info_t dqai = _dispatch_queue_attr_to_info(dqa);
    å¤åˆ¶ä»£ç 

*   `_dispatch_queue_attr_to_info`

![_dispatch_queue_attr_to_info](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5043c5ada994caa866a1622bbea7bd8~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp) åœ¨è¿™é‡Œè¿›è¡Œåˆå§‹åŒ–äº†`dqai`ï¼Œå¹¶åˆ¤æ–­`dqa`çš„ç±»å‹ï¼Œå¦‚æœæ˜¯`å¹¶å‘é˜Ÿåˆ—`ï¼Œåˆ™è®¾ç½®`å¹¶å‘é˜Ÿåˆ—`ä¸º`true`ï¼Œå¦åˆ™é»˜è®¤ä¸º`ä¸²è¡Œé˜Ÿåˆ—`ã€‚åœ¨è°ƒç”¨`_dispatch_queue_init`å¯¹`dq`è¿›è¡Œæ„é€ æ—¶ï¼Œå¯¹é˜Ÿåˆ—ç±»å‹è¿›è¡Œäº†åŒºåˆ†ï¼Œä¹Ÿå°±æ˜¯`DQF_WIDTH(width)`çš„ä¼ å‚ï¼Œä¸²è¡Œé˜Ÿåˆ—`width=1`ï¼Œå¦åˆ™ä¸º`å¹¶å‘é˜Ÿåˆ—`ã€‚

*   **`vtable`**

            const void *vtable; // - è®¾ç½®ç±» ç±»æ˜¯é€šè¿‡å®å®šä¹‰æ‹¼æ¥è€Œæˆ
            if (dqai.dqai_concurrent) {
                    // OS_dispatch_##name##_class
                    // OS_dispatch_queue_concurrent - å®å®šä¹‰æ‹¼æ¥ç±»ç±»å‹
                    vtable = DISPATCH_VTABLE(queue_concurrent);
            } else {
                    vtable = DISPATCH_VTABLE(queue_serial);
            }
    å¤åˆ¶ä»£ç 

`vtable`å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªç±»ï¼Œæˆ–è€…è¯´æ„é€ é˜Ÿåˆ—çš„æ¨¡æ¿ç±»ï¼Œ`qai`æ¥åŒºåˆ†é˜Ÿåˆ—çš„ç±»å‹ï¼Œæ ¹æ®é˜Ÿåˆ—çš„ç±»å‹æ¥åˆå§‹åŒ–ä¸åŒçš„`vtable`ã€‚`DISPATCH_VTABLE`æ˜¯ä¸€ä¸ªå®å®šä¹‰çš„æ–¹æ³•ï¼Œå…¨å±€æœç´¢`DISPATCH_VTABLE`çš„å®šä¹‰

    // DISPATCH_VTABLEå®šä¹‰
    #define DISPATCH_VTABLE(name) DISPATCH_OBJC_CLASS(name)
    
    // vtable symbols - æ¨¡æ¿
    #define DISPATCH_OBJC_CLASS(name) (&DISPATCH_CLASS_SYMBOL(name))
    
    // æ‹¼æ¥å½¢æˆç±»
    #define DISPATCH_CLASS_SYMBOL(name) OS_dispatch_##name##_class
    å¤åˆ¶ä»£ç 

`DISPATCH_VTABLE`å‡½æ•°çš„ä¼ å‚æ ¹æ®ä¸åŒçš„é˜Ÿåˆ—ç±»å‹ä¼ å‚ä¸ä¸€è‡´ã€‚

**å¹¶å‘é˜Ÿåˆ—ï¼š**

ä¼ `queue_concurrent`å‚æ•°ï¼Œæœ€ç»ˆæ‹¼æ¥åï¼Œé˜Ÿåˆ—ç±»å‹å¯¹åº”çš„ç±»ä¸ºï¼š`OS_dispatch_queue_concurrent`

**ä¸²è¡Œé˜Ÿåˆ—ï¼š**

ä¼ `queue_serial`å‚æ•°ï¼Œæœ€ç»ˆæ‹¼æ¥åï¼Œé˜Ÿåˆ—ç±»å‹å¯¹åº”çš„ç±»ä¸ºï¼š`OS_dispatch_queue_serial`

æ‰€ä»¥`vtable`å¯¹åº”çš„å°±æ˜¯é˜Ÿåˆ—çš„`ç±»å‹`ã€‚é€šè¿‡æ‹¼æ¥å®Œæˆç±»çš„å®šä¹‰ï¼Œè¿™å’Œæˆ‘ä»¬åœ¨åº”ç”¨å±‚ä½¿ç”¨çš„é˜Ÿåˆ—ç±»å‹æ˜¯ä¸€è‡´çš„ï¼Œå¦‚ä¸‹å›¾ï¼š

![æµ‹è¯•ä»£ç ](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ade7db69df14bb59adb3b2f894a8e8e~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

### 2.3 å…¨å±€é˜Ÿåˆ—åˆ†æ

> è¿›å…¥ `dispatch_get_global_queue`çš„`api`

![dispatch_get_global_queue](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d11ff44587ce4a9ea823c63079f138ba~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

*   åˆ›å»ºå…¨å±€å¹¶å‘é˜Ÿåˆ—æ—¶å¯ä»¥ä¼ å‚æ•°
*   æ ¹æ®ä¸åŒæœåŠ¡è´¨é‡æˆ–è€…ä¼˜å…ˆç­‰çº§æä¾›ä¸åŒçš„å¹¶å‘é˜Ÿåˆ—ã€‚

> é€šè¿‡å…¨å±€é˜Ÿåˆ—çš„æ ‡è¯† åœ¨æºç é‡Œé¢æœç´¢ğŸ”

![å…¨å±€é˜Ÿåˆ—é›†åˆ](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5c759da82b9f4a32a335da585053b4ac~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

*   ç³»ç»Ÿä¼šç»´æŠ¤ä¸€ä¸ª`å…¨å±€é˜Ÿåˆ—é›†åˆ`ï¼Œ
*   æ ¹æ®ä¸åŒçš„`æœåŠ¡è´¨é‡`æˆ–è€…`ä¼˜å…ˆç­‰çº§`æä¾›ä¸åŒçš„`å…¨å±€é˜Ÿåˆ—`ã€‚
*   æˆ‘ä»¬åœ¨å¼€å‘å·¥ä½œä¸­é»˜è®¤ä½¿ç”¨ï¼š`dispatch_get_global_queue(0, 0)`ã€‚

ä¸“é¢˜ç³»åˆ—æ–‡ç« 
======

### 1.å‰çŸ¥è¯†

*   **[01-æ¢ç©¶iOSåº•å±‚åŸç†|ç»¼è¿°](https://juejin.cn/post/7089043618803122183/ "https://juejin.cn/post/7089043618803122183/")**
*   **[02-æ¢ç©¶iOSåº•å±‚åŸç†|ç¼–è¯‘å™¨LLVMé¡¹ç›®ã€Clangã€SwiftCã€ä¼˜åŒ–å™¨ã€LLVMã€‘](https://juejin.cn/post/7093842449998561316/ "https://juejin.cn/post/7093842449998561316/")**
*   **[03-æ¢ç©¶iOSåº•å±‚åŸç†|LLDB](https://juejin.cn/post/7095079758844674056 "https://juejin.cn/post/7095079758844674056")**
*   **[04-æ¢ç©¶iOSåº•å±‚åŸç†|ARM64æ±‡ç¼–](https://juejin.cn/post/7115302848270696485/ "https://juejin.cn/post/7115302848270696485/")**

### 2\. åŸºäºOCè¯­è¨€æ¢ç´¢iOSåº•å±‚åŸç†

*   **[05-æ¢ç©¶iOSåº•å±‚åŸç†|OCçš„æœ¬è´¨](https://juejin.cn/post/7094409219361193997/ "https://juejin.cn/post/7094409219361193997/")**
*   **[06-æ¢ç©¶iOSåº•å±‚åŸç†|OCå¯¹è±¡çš„æœ¬è´¨](https://juejin.cn/post/7094503681684406302 "https://juejin.cn/post/7094503681684406302")**
*   **[07-æ¢ç©¶iOSåº•å±‚åŸç†|å‡ ç§OCå¯¹è±¡ã€å®ä¾‹å¯¹è±¡ã€ç±»å¯¹è±¡ã€å…ƒç±»ã€‘ã€å¯¹è±¡çš„isaæŒ‡é’ˆã€superclassã€å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ã€Classçš„åº•å±‚æœ¬è´¨](https://juejin.cn/post/7096087582370431012 "https://juejin.cn/post/7096087582370431012")**
*   **[08-æ¢ç©¶iOSåº•å±‚åŸç†|Categoryåº•å±‚ç»“æ„ã€Appå¯åŠ¨æ—¶Classä¸Categoryè£…è½½è¿‡ç¨‹ã€load å’Œ initialize æ‰§è¡Œã€å…³è”å¯¹è±¡](https://juejin.cn/post/7096480684847415303 "https://juejin.cn/post/7096480684847415303")**
*   **[09-æ¢ç©¶iOSåº•å±‚åŸç†|KVO](https://juejin.cn/post/7115318628563550244/ "https://juejin.cn/post/7115318628563550244/")**
*   **[10-æ¢ç©¶iOSåº•å±‚åŸç†|KVC](https://juejin.cn/post/7115320523805949960/ "https://juejin.cn/post/7115320523805949960/")**
*   **[11-æ¢ç©¶iOSåº•å±‚åŸç†|æ¢ç´¢Blockçš„æœ¬è´¨|ã€Blockçš„æ•°æ®ç±»å‹(æœ¬è´¨)ä¸å†…å­˜å¸ƒå±€ã€å˜é‡æ•è·ã€Blockçš„ç§ç±»ã€å†…å­˜ç®¡ç†ã€Blockçš„ä¿®é¥°ç¬¦ã€å¾ªç¯å¼•ç”¨ã€‘](https://juejin.cn/post/7115809219319693320/ "https://juejin.cn/post/7115809219319693320/")**
*   **[12-æ¢ç©¶iOSåº•å±‚åŸç†|Runtime1ã€isaè¯¦è§£ã€classçš„ç»“æ„ã€æ–¹æ³•ç¼“å­˜cache\_tã€‘](https://juejin.cn/post/7116103432095662111 "https://juejin.cn/post/7116103432095662111")**
*   **[13-æ¢ç©¶iOSåº•å±‚åŸç†|Runtime2ã€æ¶ˆæ¯å¤„ç†(å‘é€ã€è½¬å‘)&&åŠ¨æ€æ–¹æ³•è§£æã€superçš„æœ¬è´¨ã€‘](https://juejin.cn/post/7116147057739431950 "https://juejin.cn/post/7116147057739431950")**
*   **[14-æ¢ç©¶iOSåº•å±‚åŸç†|Runtime3ã€Runtimeçš„ç›¸å…³åº”ç”¨ã€‘](https://juejin.cn/post/7116291178365976590/ "https://juejin.cn/post/7116291178365976590/")**
*   **[15-æ¢ç©¶iOSåº•å±‚åŸç†|RunLoopã€ä¸¤ç§RunloopModeã€RunLoopModeä¸­çš„Source0ã€Source1ã€Timerã€Observerã€‘](https://juejin.cn/post/7116515606597206030/ "https://juejin.cn/post/7116515606597206030/")**
*   **[16-æ¢ç©¶iOSåº•å±‚åŸç†|RunLoopçš„åº”ç”¨](https://juejin.cn/post/7116521653667889165/ "https://juejin.cn/post/7116521653667889165/")**
*   **[17-æ¢ç©¶iOSåº•å±‚åŸç†|å¤šçº¿ç¨‹æŠ€æœ¯çš„åº•å±‚åŸç†ã€GCDæºç åˆ†æ1:ä¸»é˜Ÿåˆ—ã€ä¸²è¡Œé˜Ÿåˆ—&&å¹¶è¡Œé˜Ÿåˆ—ã€å…¨å±€å¹¶å‘é˜Ÿåˆ—ã€‘](https://juejin.cn/post/7116821775127674916/ "https://juejin.cn/post/7116821775127674916/")**
*   **[18-æ¢ç©¶iOSåº•å±‚åŸç†|å¤šçº¿ç¨‹æŠ€æœ¯ã€GCDæºç åˆ†æ1:dispatch\_get\_global\_queueä¸dispatch\_(a)syncã€å•ä¾‹ã€çº¿ç¨‹æ­»é”ã€‘](https://juejin.cn/post/7116878578091819045 "https://juejin.cn/post/7116878578091819045")**
*   **[19-æ¢ç©¶iOSåº•å±‚åŸç†|å¤šçº¿ç¨‹æŠ€æœ¯ã€GCDæºç åˆ†æ2:æ …æ å‡½æ•°dispatch\_barrier\_(a)syncã€ä¿¡å·é‡dispatch\_semaphoreã€‘](https://juejin.cn/post/7116897833126625316 "https://juejin.cn/post/7116897833126625316")**
*   **[20-æ¢ç©¶iOSåº•å±‚åŸç†|å¤šçº¿ç¨‹æŠ€æœ¯ã€GCDæºç åˆ†æ3:çº¿ç¨‹è°ƒåº¦ç»„dispatch\_groupã€äº‹ä»¶æºdispatch Sourceã€‘](https://juejin.cn/post/7116898446358888485/ "https://juejin.cn/post/7116898446358888485/")**
*   **[21-æ¢ç©¶iOSåº•å±‚åŸç†|å¤šçº¿ç¨‹æŠ€æœ¯ã€çº¿ç¨‹é”ï¼šè‡ªæ—‹é”ã€äº’æ–¥é”ã€é€’å½’é”ã€‘](https://juejin.cn/post/7116898868737867789/ "https://juejin.cn/post/7116898868737867789/")**
*   **[22-æ¢ç©¶iOSåº•å±‚åŸç†|å¤šçº¿ç¨‹æŠ€æœ¯ã€åŸå­é”atomicã€gcd Timerã€NSTimerã€CADisplayLinkã€‘](https://juejin.cn/post/7116907029465137165 "https://juejin.cn/post/7116907029465137165")**
*   **[23-æ¢ç©¶iOSåº•å±‚åŸç†|å†…å­˜ç®¡ç†ã€Mach-Oæ–‡ä»¶ã€Tagged Pointerã€å¯¹è±¡çš„å†…å­˜ç®¡ç†ã€copyã€å¼•ç”¨è®¡æ•°ã€weakæŒ‡é’ˆã€autorelease](https://juejin.cn/post/7117274106940096520 "https://juejin.cn/post/7117274106940096520")**

### 3\. åŸºäºSwiftè¯­è¨€æ¢ç´¢iOSåº•å±‚åŸç†

å…³äº`å‡½æ•°`ã€`æšä¸¾`ã€`å¯é€‰é¡¹`ã€`ç»“æ„ä½“`ã€`ç±»`ã€`é—­åŒ…`ã€`å±æ€§`ã€`æ–¹æ³•`ã€`swiftå¤šæ€åŸç†`ã€`String`ã€`Array`ã€`Dictionary`ã€`å¼•ç”¨è®¡æ•°`ã€`MetaData`ç­‰SwiftåŸºæœ¬è¯­æ³•å’Œç›¸å…³çš„åº•å±‚åŸç†æ–‡ç« æœ‰å¦‚ä¸‹å‡ ç¯‡:

*   [Swift5æ ¸å¿ƒè¯­æ³•1-åŸºç¡€è¯­æ³•](https://juejin.cn/post/7119020967430455327 "https://juejin.cn/post/7119020967430455327")
*   [Swift5æ ¸å¿ƒè¯­æ³•2-é¢å‘å¯¹è±¡è¯­æ³•1](https://juejin.cn/post/7119510159109390343 "https://juejin.cn/post/7119510159109390343")
*   [Swift5æ ¸å¿ƒè¯­æ³•2-é¢å‘å¯¹è±¡è¯­æ³•2](https://juejin.cn/post/7119513630550261774 "https://juejin.cn/post/7119513630550261774")
*   [Swift5å¸¸ç”¨æ ¸å¿ƒè¯­æ³•3-å…¶å®ƒå¸¸ç”¨è¯­æ³•](https://juejin.cn/post/7119714488181325860 "https://juejin.cn/post/7119714488181325860")
*   [Swift5åº”ç”¨å®è·µå¸¸ç”¨æŠ€æœ¯ç‚¹](https://juejin.cn/post/7119722433589805064 "https://juejin.cn/post/7119722433589805064")

å…¶å®ƒåº•å±‚åŸç†ä¸“é¢˜
========

### 1.åº•å±‚åŸç†ç›¸å…³ä¸“é¢˜

*   [01-è®¡ç®—æœºåŸç†|è®¡ç®—æœºå›¾å½¢æ¸²æŸ“åŸç†è¿™ç¯‡æ–‡ç« ](https://juejin.cn/post/7018755998823219213 "https://juejin.cn/post/7018755998823219213")
*   [02-è®¡ç®—æœºåŸç†|ç§»åŠ¨ç»ˆç«¯å±å¹•æˆåƒä¸å¡é¡¿Â ](https://juejin.cn/post/7019117942377807908 "https://juejin.cn/post/7019117942377807908")

### 2.iOSç›¸å…³ä¸“é¢˜

*   [01-iOSåº•å±‚åŸç†|iOSçš„å„ä¸ªæ¸²æŸ“æ¡†æ¶ä»¥åŠiOSå›¾å±‚æ¸²æŸ“åŸç†](https://juejin.cn/post/7019193784806146079 "https://juejin.cn/post/7019193784806146079")
*   [02-iOSåº•å±‚åŸç†|iOSåŠ¨ç”»æ¸²æŸ“åŸç†](https://juejin.cn/post/7019200157119938590 "https://juejin.cn/post/7019200157119938590")
*   [03-iOSåº•å±‚åŸç†|iOS OffScreen Rendering ç¦»å±æ¸²æŸ“åŸç†](https://juejin.cn/post/7019497906650497061/ "https://juejin.cn/post/7019497906650497061/")
*   [04-iOSåº•å±‚åŸç†|å› CPUã€GPUèµ„æºæ¶ˆè€—å¯¼è‡´å¡é¡¿çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆ](https://juejin.cn/post/7020613901033144351 "https://juejin.cn/post/7020613901033144351")

### 3.webAppç›¸å…³ä¸“é¢˜

*   [01-Webå’Œç±»RNå¤§å‰ç«¯çš„æ¸²æŸ“åŸç†](https://juejin.cn/post/7021035020445810718/ "https://juejin.cn/post/7021035020445810718/")

### 4.è·¨å¹³å°å¼€å‘æ–¹æ¡ˆç›¸å…³ä¸“é¢˜

*   [01-Flutteré¡µé¢æ¸²æŸ“åŸç†](https://juejin.cn/post/7021057396147486750/ "https://juejin.cn/post/7021057396147486750/")

### 5.é˜¶æ®µæ€§æ€»ç»“:Nativeã€WebAppã€è·¨å¹³å°å¼€å‘ä¸‰ç§æ–¹æ¡ˆæ€§èƒ½æ¯”è¾ƒ

*   [01-Nativeã€WebAppã€è·¨å¹³å°å¼€å‘ä¸‰ç§æ–¹æ¡ˆæ€§èƒ½æ¯”è¾ƒ](https://juejin.cn/post/7021071990723182606/ "https://juejin.cn/post/7021071990723182606/")

### 6.Androidã€HarmonyOSé¡µé¢æ¸²æŸ“ä¸“é¢˜

*   [01-Androidé¡µé¢æ¸²æŸ“åŸç†](https://juejin.cn/post/7021840737431978020/ "https://juejin.cn/post/7021840737431978020/")
*   [02-HarmonyOSé¡µé¢æ¸²æŸ“åŸç†](# "#") (`å¾…è¾“å‡º`)

### 7.å°ç¨‹åºé¡µé¢æ¸²æŸ“ä¸“é¢˜

*   [01-å°ç¨‹åºæ¡†æ¶æ¸²æŸ“åŸç†](https://juejin.cn/post/7021414123346853919 "https://juejin.cn/post/7021414123346853919")